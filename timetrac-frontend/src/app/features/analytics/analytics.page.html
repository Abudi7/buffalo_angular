<ion-content>
  <!-- Header -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ t('analytics.title') }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>{{ t('analytics.description') }}</p>
    </ion-card-content>
  </ion-card>

  <!-- Date Range Filter -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ t('analytics.dateRange') }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="date-range-controls">
        <ion-item>
          <ion-label>{{ t('analytics.startDate') }}</ion-label>
          <ion-datetime-button datetime="start-datetime"></ion-datetime-button>
        </ion-item>
        <ion-item>
          <ion-label>{{ t('analytics.endDate') }}</ion-label>
          <ion-datetime-button datetime="end-datetime"></ion-datetime-button>
        </ion-item>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Key Metrics -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ t('analytics.keyMetrics') }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="6" size-md="3">
            <div class="metric">
              <div class="metric-value">{{ formatDuration(totalHours) }}</div>
              <div class="metric-label">{{ t('analytics.totalHours') }}</div>
            </div>
          </ion-col>
          <ion-col size="6" size-md="3">
            <div class="metric">
              <div class="metric-value">{{ totalEntries }}</div>
              <div class="metric-label">{{ t('analytics.totalEntries') }}</div>
            </div>
          </ion-col>
          <ion-col size="6" size-md="3">
            <div class="metric">
              <div class="metric-value">{{ averageHours }}</div>
              <div class="metric-label">{{ t('analytics.averageHours') }}</div>
            </div>
          </ion-col>
          <ion-col size="6" size-md="3">
            <div class="metric">
              <div class="metric-value">{{ activeProjects }}</div>
              <div class="metric-label">
                {{ t('analytics.activeProjects') }}
              </div>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Daily Tracking Chart -->
  <ion-card class="chart-card">
    <ion-card-header>
      <ion-card-title>{{ t('analytics.dailyTracking') }}</ion-card-title>
      <ion-card-subtitle>Last 7 days</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <div class="chart-container">
        <div class="chart-bars">
          <div
            *ngFor="let day of weeklyData; let i = index"
            class="chart-bar-container"
          >
            <div class="chart-bar" [style.height.%]="getBarHeight(day.hours)">
              <div class="bar-value">{{ day.hours }}h</div>
            </div>
            <div class="bar-label">{{ day.day }}</div>
          </div>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Project Distribution Chart -->
  <ion-card class="chart-card">
    <ion-card-header>
      <ion-card-title>{{ t('analytics.projectDistribution') }}</ion-card-title>
      <ion-card-subtitle>Time spent by project</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <div class="chart-container">
        <div class="project-list">
          <div
            *ngFor="let project of projectData; let i = index"
            class="project-item"
          >
            <div class="project-info">
              <div
                class="project-color"
                [style.background-color]="getProjectColor(i)"
              ></div>
              <div class="project-details">
                <div class="project-name">{{ project.name }}</div>
                <div class="project-hours">
                  {{ project.hours }}h ({{ project.percentage }}%)
                </div>
              </div>
            </div>
            <div class="project-bar">
              <div
                class="project-progress"
                [style.width.%]="project.percentage"
                [style.background-color]="getProjectColor(i)"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Weekly Overview Chart -->
  <ion-card class="chart-card">
    <ion-card-header>
      <ion-card-title>Weekly Overview</ion-card-title>
      <ion-card-subtitle>Hours tracked this week</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <div class="chart-container">
        <div class="circular-progress">
          <div
            class="progress-circle"
            [style.background]="getCircularProgress()"
          >
            <div class="progress-content">
              <div class="progress-value">{{ totalHours }}h</div>
              <div class="progress-label">This Week</div>
            </div>
          </div>
        </div>
        <div class="progress-details">
          <div class="detail-item">
            <span class="detail-label">Goal:</span>
            <span class="detail-value">40h</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Remaining:</span>
            <span class="detail-value">{{ 40 - totalHours }}h</span>
          </div>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Hourly Productivity Chart -->
  <ion-card class="chart-card">
    <ion-card-header>
      <ion-card-title>{{ t('analytics.hourlyProductivity') }}</ion-card-title>
      <ion-card-subtitle>Most productive hours</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <div class="chart-container">
        <div class="hourly-chart">
          <div
            *ngFor="let hour of hourlyData; let i = index"
            class="hourly-bar-container"
          >
            <div
              class="hourly-bar"
              [style.height.%]="getHourlyBarHeight(hour.value)"
            >
              <div class="bar-value">{{ hour.value }}h</div>
            </div>
            <div class="hour-label">{{ hour.hour }}:00</div>
          </div>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <ion-skeleton-text
      animated
      style="width: 100%; height: 200px"
    ></ion-skeleton-text>
    <ion-skeleton-text
      animated
      style="width: 80%; height: 100px"
    ></ion-skeleton-text>
    <ion-skeleton-text
      animated
      style="width: 60%; height: 100px"
    ></ion-skeleton-text>
  </div>
</ion-content>

<!-- Date Time Modals -->
<ion-modal [keepContentsMounted]="true">
  <ng-template>
    <ion-datetime
      id="start-datetime"
      presentation="date"
      [value]="startDate"
      (ionChange)="onStartDateChange($event)"
    >
    </ion-datetime>
  </ng-template>
</ion-modal>

<ion-modal [keepContentsMounted]="true">
  <ng-template>
    <ion-datetime
      id="end-datetime"
      presentation="date"
      [value]="endDate"
      (ionChange)="onEndDateChange($event)"
    >
    </ion-datetime>
  </ng-template>
</ion-modal>
