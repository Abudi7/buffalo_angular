<!-- Modern Home Design -->
<div class="modern-home">
  <!-- Background with floating elements -->
  <div class="home-background">
    <div class="floating-shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
      <div class="shape shape-4"></div>
    </div>
  </div>

  <!-- Pull to refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="load($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Modern Header Section -->
  <div class="home-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="app-title">{{ t('app_title') }}</h1>
        <p class="date-subtitle">{{ today | date:'EEEE, MMM d' }}</p>
        <p class="welcome-message">{{ t('welcome_message') }}</p>
      </div>
      <div class="header-right">
        <div class="language-selector">
          <ion-segment
            value="en"
            (ionChange)="onLangChange($event)"
            class="modern-segment"
          >
            <ion-segment-button value="en">EN</ion-segment-button>
            <ion-segment-button value="ar">AR</ion-segment-button>
            <ion-segment-button value="de">DE</ion-segment-button>
          </ion-segment>
        </div>
        <div class="header-actions">
          <button class="modern-button secondary" (click)="load()">
            <ion-icon name="refresh-outline"></ion-icon>
            {{ t('refresh') }}
          </button>
          <button class="modern-button secondary" (click)="exportCsv()">
            <ion-icon name="download-outline"></ion-icon>
            {{ t('export_csv') }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modern Live Clock -->
  <div class="modern-clock" [class.pulsing]="!!runningEntry">
    <div class="clock-container">
      <div class="clock-icon">
        <ion-icon [name]="'time-outline'"></ion-icon>
      </div>
      <div class="clock-time">{{ hhmmss(elapsedMs) }}</div>
    </div>
  </div>

  <!-- Modern Controls Section -->
  <div class="modern-controls">
    <!-- Time Tracking Card -->
    <div class="tracking-card">
      <div class="card-header">
        <h2 class="card-title">{{ t('track_time') }}</h2>
        <p class="card-subtitle">{{ t('select_project_tags_note_color') }}</p>
      </div>

      <div class="card-content">
        <!-- Project + Color Selection -->
        <div class="input-group">
          <div class="input-wrapper">
            <ion-icon name="folder-outline" class="input-icon"></ion-icon>
            <ion-select
              interface="popover"
              [(ngModel)]="selectedProject"
              class="modern-select"
            >
              <ion-select-option *ngFor="let p of projects" [value]="p"
                >{{ p }}</ion-select-option
              >
            </ion-select>
          </div>
          <div class="color-picker">
            <ion-icon name="color-palette-outline" class="color-icon"></ion-icon>
            <input type="color" [(ngModel)]="color" class="color-input" />
          </div>
        </div>

        <!-- Location + Photo Actions -->
        <div class="action-buttons">
          <button class="modern-button secondary" (click)="getLocation()">
            <ion-icon name="location-outline"></ion-icon>
            Use Location
          </button>
          <button 
            class="modern-button" 
            [class.success]="photo_data"
            (click)="addPhoto()"
          >
            <ion-icon name="camera-outline"></ion-icon>
            {{ photo_data ? 'Photo Added' : 'Add Photo' }}
          </button>
        </div>

        <!-- Photo Preview -->
        <div *ngIf="photo_data" class="photo-preview">
          <div class="photo-content">
            <img [src]="photo_data" alt="Captured photo" class="photo-thumbnail" />
            <div class="photo-info">
              <div class="photo-title">Photo captured</div>
              <div class="photo-subtitle">Ready to attach to time entry</div>
            </div>
            <button class="clear-photo" (click)="clearPhoto()">
              <ion-icon name="close-outline"></ion-icon>
            </button>
          </div>
        </div>

        <!-- Tags Section -->
        <div class="tags-section">
          <label class="section-label">{{ t('tags') }}</label>
          <div class="tags-container">
            <div class="tags-list">
              <span *ngFor="let t of tags" class="tag">
                {{ t }}
                <button class="tag-remove" (click)="removeTag(t)">
                  <ion-icon name="close-outline"></ion-icon>
                </button>
              </span>
            </div>
            <div class="tag-input-container">
              <input
                class="tag-input"
                placeholder="Add tag and press Enter"
                [(ngModel)]="tagInput"
                (keyup.enter)="addTag()"
              />
              <button class="add-tag-btn" (click)="addTag()">
                <ion-icon name="add-outline"></ion-icon>
              </button>
            </div>
          </div>
        </div>

        <!-- Note Section -->
        <div class="note-section">
          <label class="section-label">{{ t('note') }}</label>
          <div class="note-input-wrapper">
            <ion-textarea
              autoGrow="true"
              [placeholder]="'What are you working on?'"
              [(ngModel)]="note"
              class="modern-textarea"
            ></ion-textarea>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="tracking-actions">
          <button
            class="modern-button primary start-btn"
            (click)="start()"
            [disabled]="!!runningEntry"
          >
            <ion-icon name="play-circle-outline"></ion-icon>
            {{ t('start') }}
          </button>
          <button
            class="modern-button danger stop-btn"
            (click)="stop()"
            [disabled]="!runningEntry"
          >
            <ion-icon name="stop-circle-outline"></ion-icon>
            {{ t('stop') }}
          </button>
        </div>
      </div>
    </div>

    <!-- Modern Entries List -->
    <div class="entries-card">
      <div class="card-header">
        <h2 class="card-title">{{ t('entries') }}</h2>
        <p class="card-subtitle">{{ t('newest_first') }}</p>
      </div>

      <div class="card-content">
        <ng-container *ngIf="loading; else entriesTpl">
          <div class="skeleton-list">
            <div class="skeleton-item" *ngFor="let i of [1,2,3]">
              <div class="skeleton-dot"></div>
              <div class="skeleton-content">
                <div class="skeleton-line"></div>
                <div class="skeleton-line short"></div>
              </div>
            </div>
          </div>
        </ng-container>

        <ng-template #entriesTpl>
          <div *ngIf="entries.length === 0" class="empty-state">
            <div class="empty-icon">
              <ion-icon name="document-text-outline"></ion-icon>
            </div>
            <p class="empty-text">{{ t('no_entries') }}</p>
          </div>

          <div class="entries-list">
            <div
              class="entry-item"
              *ngFor="let e of entries; trackBy: trackById; let i = index"
            >
              <div class="entry-dot" [style.background]="e.color"></div>
              <div class="entry-content">
                <div class="entry-header">
                  <h3 class="entry-project">{{ e.project || 'No project' }}</h3>
                  <span class="entry-duration" [style.border-color]="e.color">
                    {{ durationPretty(e) }}
                  </span>
                </div>

                <div class="entry-times">
                  {{ e.start_at | date:'short' }}
                  <ng-container *ngIf="e.end_at as end">
                    â†’ {{ end | date:'short' }}
                  </ng-container>
                </div>

                <div class="entry-tags" *ngIf="e.tags?.length">
                  <span *ngFor="let t of e.tags" class="entry-tag">{{ t }}</span>
                </div>

                <div class="entry-note" *ngIf="e.note">
                  <ion-icon name="document-text-outline"></ion-icon>
                  <span>{{ e.note }}</span>
                </div>

                <div
                  *ngIf="e.location_addr || (e.location_lat && e.location_lng)"
                  class="entry-location"
                >
                  <ion-icon name="location-outline"></ion-icon>
                  {{ e.location_addr || (e.location_lat + ', ' + e.location_lng) }}
                </div>

                <div *ngIf="e.photo_data" class="entry-photo">
                  <img [src]="e.photo_data" alt="photo" class="entry-photo-img" />
                </div>

                <div class="entry-meta">
                  <span>Created: {{ e.created_at | date:'short' }}</span>
                  <span>Updated: {{ e.updated_at | date:'short' }}</span>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
